:root { color-scheme: dark; }
* { box-sizing: border-box; }

body {
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
  margin: 0; padding: 18px; background: #0f0f12; color: #eaeaf0;
}

/* ═══ Logo ═══ */
.logo-link {
  display: inline-flex; align-items: center; gap: 10px;
  text-decoration: none; color: inherit; margin-bottom: 12px;
  transition: opacity 150ms ease;
}
.logo-link:hover { opacity: 0.85; }
.logo-svg { flex-shrink: 0; }
.logo-text { display: flex; flex-direction: column; gap: 1px; }
.logo-name {
  font-size: 18px; font-weight: 800;
  background: linear-gradient(135deg, #c084fc, #22d3ee, #34d399);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text; line-height: 1.15;
}
.logo-sub { font-size: 11px; color: #71717a; letter-spacing: 0.5px; }

/* ═══ Headings ═══ */
h1 { margin: 0 0 6px; color: #c084fc; font-size: 22px; }
h2 { color: #eaeaf0; }
.hint { margin: 0 0 14px; color: #a1a1aa; line-height: 1.35; }

/* ═══ Panel ═══ */
.panel {
  background: #15151b;
  border: 1px solid #2a2a35;
  border-radius: 14px;
  padding: 12px;
}

/* ═══════════════════════════════════════════════
   LAYOUT — десктоп (>980px)
   Две колонки: [dock + controls] слева, [phrases] справа
   Вся левая колонка sticky
   ═══════════════════════════════════════════════ */
.layout {
  display: grid;
  grid-template-columns: 1.1fr 1fr;
  grid-template-rows: auto auto 1fr;
  gap: 14px;
  align-items: start;
}

/* A: dock — в первую колонку, первый ряд */
.videoDock {
  grid-column: 1;
  grid-row: 1;
  position: sticky;
  top: 10px;
  z-index: 100;
}

/* B: controls — в первую колонку, второй ряд */
.playerControls {
  grid-column: 1;
  grid-row: 2;
}

/* C: phrases — вторая колонка, растянуть на все ряды */
#phrasesPanel {
  grid-column: 2;
  grid-row: 1 / 4;
}

/* ═══ Dock status bar (лампочка + таймер) ═══ */
.dock-status {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
  margin-bottom: 8px;
}

/* ═══ Player ═══ */
#player {
  width: 100%;
  display: block;
}
#player.is-audio {
  height: 48px;
  background: transparent;
  border-radius: 0;
}
#player.is-video {
  width: 100%;
  height: 180px;
  object-fit: cover;
  object-position: center 40%;
  background: #000;
  border-radius: 12px;
}

/* ═══════════════════════════════════════════════
   ПОРТРЕТ МОБИЛЬНЫЙ (<980px portrait)
   Одна колонка: dock sticky, controls скроллятся, phrases скроллятся
   dock sticky-контейнер = .layout, а .layout тянется до конца phrases
   ═══════════════════════════════════════════════ */
@media (max-width: 980px) and (orientation: portrait) {
  .layout {
    grid-template-columns: 1fr;
    grid-template-rows: auto auto 1fr;
  }

  /* A: dock — первая ячейка, sticky */
  .videoDock {
    grid-column: 1;
    grid-row: 1;
    position: sticky;
    top: 0;
    z-index: 120;
    border-radius: 0 0 14px 14px;
    margin: -18px -18px 0 -18px;   /* тянем на всю ширину body */
    padding: 8px 18px 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.6);
  }

  /* B: controls — вторая ячейка, обычный поток */
  .playerControls {
    grid-column: 1;
    grid-row: 2;
  }

  /* C: phrases — третья ячейка */
  #phrasesPanel {
    grid-column: 1;
    grid-row: 3;
  }

  #player.is-video {
    height: 160px;
    border-radius: 8px;
  }
  #player.is-audio {
    height: 44px;
  }
}

/* ═══════════════════════════════════════════════
   ЛАНДШАФТ МОБИЛЬНЫЙ (<980px landscape)
   Две колонки: всё слева sticky, phrases справа
   ═══════════════════════════════════════════════ */
@media (max-width: 980px) and (orientation: landscape) {
  .layout {
    grid-template-columns: minmax(260px, 0.85fr) 1fr;
    grid-template-rows: auto auto 1fr;
  }
  .videoDock {
    grid-column: 1;
    grid-row: 1;
    position: sticky;
    top: 4px;
    z-index: 100;
  }
  .playerControls {
    grid-column: 1;
    grid-row: 2;
  }
  #phrasesPanel {
    grid-column: 2;
    grid-row: 1 / 4;
  }
  #player.is-video {
    height: 140px;
  }
}

/* ═══ Buttons ═══ */
button {
  border: 0; border-radius: 10px; padding: 8px 10px;
  cursor: pointer; background: #2d2d3a; color: #eaeaf0;
  font-size: 14px; transition: filter 100ms ease;
}
button:hover { filter: brightness(1.07); }
button:disabled { opacity: 0.4; cursor: default; filter: none; }
.primary, .btn-primary { background: #7c3aed; color: #fff; }
.good, .btn-good { background: #10b981; color: #071b12; }
.warn { background: #f59e0b; color: #1a1204; }
.bad { background: #ef4444; color: #1f0505; }
.ghost { background: transparent; border: 1px solid #2a2a35; }
.tiny { font-size: 12px; padding: 4px 8px; border-radius: 8px; }

/* ═══ Inputs ═══ */
input[type="number"],
input[type="text"],
textarea {
  background: #0f0f12; color: #eaeaf0;
  border: 1px solid #2a2a35; border-radius: 10px;
  padding: 8px 10px; font-size: 14px; font-family: inherit;
}
input[type="number"] { width: 96px; }
textarea { width: 100%; min-height: 110px; resize: vertical; }

/* ═══ Utility ═══ */
.mini { font-size: 12px; color: #a1a1aa; }
.mono { font-family: "SF Mono", "Fira Code", "Cascadia Code", Consolas, monospace; }
.muted { opacity: .6; }
.sep { height: 1px; background: #2a2a35; margin: 12px 0; }
.pill {
  display: inline-block; padding: 3px 8px; border-radius: 999px;
  background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.10);
  font-size: 12px; color: #cbd5e1; white-space: nowrap;
}
.topbar {
  display: flex; flex-wrap: wrap; gap: 10px;
  align-items: center; margin-bottom: 10px;
}

/* ═══ LED Lamp ═══ */
.lamp-wrap { display: inline-flex; align-items: center; gap: 6px; margin-left: 4px; }
.lamp-label { font-size: 10px; color: #555; text-transform: uppercase; letter-spacing: 0.5px; }
.lamp {
  position: relative; width: 14px; height: 14px; border-radius: 50%;
  border: 1.5px solid rgba(255,255,255,0.12); transition: all 350ms ease;
  background: radial-gradient(circle at 40% 35%, rgba(255,255,255,0.25) 0%, transparent 55%);
}
.lamp::after {
  content: ""; position: absolute; top: 2px; left: 2px;
  width: 4px; height: 4px; border-radius: 50%;
  background: rgba(255,255,255,0.45); filter: blur(0.5px);
}
.lamp-off {
  background: radial-gradient(circle at 40% 35%, rgba(255,255,255,0.15) 0%, transparent 55%),
    radial-gradient(circle, #222 0%, #111 100%);
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.6), 0 0 2px rgba(0,0,0,0.5);
}
.lamp-green {
  background: radial-gradient(circle at 40% 35%, rgba(255,255,255,0.5) 0%, transparent 45%),
    radial-gradient(circle, #4ade80 0%, #16a34a 60%, #0a5c2a 100%);
  box-shadow: inset 0 1px 2px rgba(255,255,255,0.15),
    0 0 4px 1px rgba(74,222,128,0.5), 0 0 12px 3px rgba(74,222,128,0.25),
    0 0 24px 6px rgba(74,222,128,0.08);
  border-color: rgba(74,222,128,0.3);
}
.lamp-red {
  background: radial-gradient(circle at 40% 35%, rgba(255,255,255,0.5) 0%, transparent 45%),
    radial-gradient(circle, #f87171 0%, #dc2626 60%, #7f1d1d 100%);
  box-shadow: inset 0 1px 2px rgba(255,255,255,0.15),
    0 0 4px 1px rgba(248,113,113,0.5), 0 0 12px 3px rgba(248,113,113,0.25),
    0 0 24px 6px rgba(248,113,113,0.08);
  border-color: rgba(248,113,113,0.3);
}

/* ═══ Pulse ═══ */
@keyframes pulse-glow {
  0%, 100% { box-shadow: 0 0 0 0 rgba(124,58,237,0.6); border-color: #7c3aed; }
  50% { box-shadow: 0 0 0 10px rgba(124,58,237,0); border-color: #a78bfa; }
}
.pulse {
  animation: pulse-glow 1.2s ease-in-out infinite !important;
  border-color: #7c3aed !important; position: relative; z-index: 10;
}

/* ═══ Media row ═══ */
.media-row {
  display: flex; flex-wrap: wrap; gap: 8px;
  align-items: center; margin-bottom: 10px;
}

/* ═══ JS-off fallback ═══ */
#jsNotRunning {
  display: block; margin: 12px 0; padding: 12px 14px;
  border-radius: 14px; border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06); line-height: 1.35;
}
.js #jsNotRunning { display: none; }

/* ═══ Lines ═══ */
.line {
  padding: 10px 12px; border-radius: 12px; background: #111118;
  border: 1px solid #242432; margin-bottom: 8px; cursor: pointer;
  transition: border-color 120ms ease, box-shadow 120ms ease;
}
.line:hover { border-color: #3a3a50; }
.line.active { border-color: #7c3aed; box-shadow: 0 0 0 2px rgba(124,58,237,0.25); }
.line.learned { border-left: 3px solid #10b981; }
.line-header { display: flex; gap: 10px; align-items: center; margin-bottom: 6px; }
.line-num {
  display: flex; align-items: center; justify-content: center;
  width: 28px; height: 28px; border-radius: 50%;
  background: rgba(124,58,237,0.15); color: #c084fc;
  font-size: 12px; font-weight: 700; flex-shrink: 0;
}
.user-heard {
  flex: 1; min-width: 0; background: #0a0a0f;
  border: 1px solid #2a2a35; border-radius: 8px; padding: 6px 10px;
  color: #fbbf24; font-size: 15px; font-style: italic;
}
.user-heard::placeholder { color: #555; font-style: italic; }
.orig-row { display: flex; gap: 8px; align-items: flex-start; margin-bottom: 4px; }
.orig-text { font-size: 16px; line-height: 1.35; color: #eaeaf0; }
.btn-reveal { flex-shrink: 0; }
.line-actions { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 6px; }

/* ═══ Sub-panels ═══ */
.sub {
  max-height: 0; overflow: hidden; opacity: 0;
  transition: max-height 200ms ease, opacity 180ms ease, margin 180ms ease;
  margin-top: 0;
}
.sub.visible { max-height: 400px; opacity: 1; margin-top: 8px; }
.subCard {
  padding: 8px 10px; border-radius: 10px;
  background: rgba(255,255,255,0.04); border: 1px solid #2a2a35;
  font-size: 14px; line-height: 1.45;
}

/* ═══ Toast ═══ */
#toast {
  position: fixed; bottom: 20px; left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: #1e1e2a; border: 1px solid #3a3a50; border-radius: 14px;
  padding: 10px 18px; font-size: 14px; color: #eaeaf0;
  opacity: 0; pointer-events: none;
  transition: opacity 200ms ease, transform 200ms ease;
  z-index: 999; max-width: 90vw; text-align: center;
}
#toast.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
#toast small { display: block; margin-top: 4px; font-size: 12px; color: #a1a1aa; }

/* ═══ Toggle row ═══ */
.toggleRow {
  display: flex; gap: 14px; flex-wrap: wrap;
  align-items: center; margin-bottom: 10px;
}
.toggleRow label {
  display: flex; gap: 6px; align-items: center;
  font-size: 13px; cursor: pointer; user-select: none;
}

/* ═══ Seg status ═══ */
#segStatus {
  display: flex; gap: 8px; flex-wrap: wrap;
  align-items: center; margin: 8px 0;
}

/* ═══ Song Catalog ═══ */
.songCard {
  display: block; text-decoration: none; color: inherit;
  padding: 14px; border-radius: 14px; background: #111118;
  border: 1px solid #242432; margin-bottom: 10px;
  transition: border-color 120ms ease;
}
.songCard:hover { border-color: #7c3aed; }
.songTitle { font-size: 18px; font-weight: 700; color: #c084fc; }
.songMeta { display: flex; gap: 8px; margin-top: 6px; flex-wrap: wrap; }
.songSmall { font-size: 13px; color: #a1a1aa; margin-top: 6px; }

/* ═══ Storage banner ═══ */
#storageBanner {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000;
  background: #1a1a26; border-top: 1px solid #2a2a35;
  padding: 12px 18px; display: flex; gap: 12px;
  align-items: center; justify-content: center; flex-wrap: wrap;
  font-size: 13px; color: #a1a1aa; animation: slideUp 300ms ease;
}
#storageBanner button {
  background: #7c3aed; color: #fff; border: 0; border-radius: 8px;
  padding: 6px 16px; font-size: 13px; cursor: pointer; flex-shrink: 0;
}
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

/* ═══ Author phonetic ═══ */
.phon-author { color: #34d399; }

/* ═══ Legacy ═══ */
.videoDockSentinel { display: none; }
.playerWrap { /* legacy class — больше не используется в grid */ }
/* ═══ Save indicator ═══ */
.save-indicator {
  text-align: center;
  font-size: 12px;
  opacity: 0.35;
  padding: 10px 0 2px;
  user-select: none;
  transition: opacity 0.3s;
}
.save-indicator.flash {
  opacity: 0.9;
}

/* ═══ Page footer with reset ═══ */
.page-footer {
  text-align: center;
  padding: 32px 0 24px;
}
.link-btn {
  background: none;
  border: none;
  color: inherit;
  opacity: 0.2;
  font-size: 11px;
  cursor: pointer;
  text-decoration: underline;
  transition: opacity 0.2s;
}
.link-btn:hover {
  opacity: 0.55;
}
/* ══════════════════════════════════════
   Spectrogram
   ══════════════════════════════════════ */
.spec-panel {
  margin-top: 10px;
  padding: 8px 10px 10px;
}

.spec-toolbar {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
  flex-wrap: wrap;
}

.spec-zoom-btn {
  width: 44px;
  height: 44px;
  font-size: 22px;
  font-weight: 700;
  line-height: 1;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.spec-wrap {
  position: relative;
  width: 100%;
  height: 140px;
  border-radius: 8px;
  overflow: hidden;
  background: #0a0818;
  transition: height 0.25s ease;
}

.spec-wrap.collapsed {
  height: 0;
  overflow: hidden;
}

.spec-wrap canvas {
  display: block;
  width: 100%;
  height: 100%;
}

@media (min-width: 700px) {
  .spec-wrap {
    height: 180px;
  }
  }
